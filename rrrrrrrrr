server {
    server_name 10.0.2.15;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /home/vboxuser/SuperWebProgramming/car/carapp/static;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    listen 80;
}

[Unit]
Description=gunicorn daemon for car
After=network.target

[Service]
User=your_user
Group=your_group
WorkingDirectory=/path/to/your/project
ExecStart=/path/to/your/venv/bin/gunicorn --workers 3 --bind unix:/path/to/your/project/car.sock car.wsgi:application

[Install]
WantedBy=multi-user.target


def fetch_currency_data():

    # Настройка Selenium
    options = webdriver.ChromeOptions()
    options.add_argument('--headless')  # Запуск в фоновом режиме (без GUI)
    driver = webdriver.Chrome(service=Service(ChromeDriverManager().install()), options=options)

    try:
        driver.get("https://bbr.ru/")  

        accept_cookies_button = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.XPATH, "//button[text()='Принять']"))
        )
        accept_cookies_button.click()

        eur_sell_price = WebDriverWait(driver, 10).until(
            EC.visibility_of_element_located((By.XPATH, "//span[text()='продажа']/following-sibling::div/span"))
        ).text
        eur_sell_price = eur_sell_price.replace(',', '.')

        expand_table_button = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.XPATH, "//button[contains(@class, 'css-15bdcy0') and contains(., 'Все валюты')]"))
        )
        expand_table_button.click()

        time.sleep(2)  

        currency_data = {"EUR": eur_sell_price}

        rows = WebDriverWait(driver, 10).until(
            EC.presence_of_all_elements_located((By.XPATH, "//table[@class='css-1uixtsi e23c5745']//tbody/tr"))
        )
        for row in rows:
            cells = row.find_elements(By.TAG_NAME, "td")
            if len(cells) >= 3:
                currency_code = cells[1].text
                sell_price = cells[4].text
                cleaned_price = sell_price.replace(',', '.')
                currency_data[currency_code] = cleaned_price
            
    finally:
        driver.quit()

    return currency_data
